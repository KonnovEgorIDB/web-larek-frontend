(()=>{"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===_typeof(i)?i:String(i)),n)}var o,i}var e=function(){function Api(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Api),this.baseUrl=e,this.options={headers:Object.assign({"Content-Type":"application/json"},null!==(t=r.headers)&&void 0!==t?t:{})}}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Api,[{key:"handleResponse",value:function handleResponse(e){return e.ok?e.json():e.json().then((function(t){var r;return Promise.reject(null!==(r=t.error)&&void 0!==r?r:e.statusText)}))}},{key:"get",value:function get(e){return fetch(this.baseUrl+e,Object.assign(Object.assign({},this.options),{method:"GET"})).then(this.handleResponse)}},{key:"post",value:function post(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST";return fetch(this.baseUrl+e,Object.assign(Object.assign({},this.options),{method:r,body:JSON.stringify(t)})).then(this.handleResponse)}}]),Api}(),t="".concat("https://larek-api.nomoreparties.co","/api/weblarek"),r="".concat("https://larek-api.nomoreparties.co","/content/weblarek");function models_typeof(e){return models_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},models_typeof(e)}function models_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function models_toPrimitive(e,t){if("object"!==models_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==models_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===models_typeof(i)?i:String(i)),n)}var o,i}function models_createClass(e,t,r){return t&&models_defineProperties(e.prototype,t),r&&models_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function models_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=models_createClass((function Item(e){models_classCallCheck(this,Item),this.id=e.id,this.category=e.category,this.title=e.title,this.image=e.image,this.price=e.price,this.description=e.description})),o=function(){function OrderModel(){models_classCallCheck(this,OrderModel),this.payment=null,this.itemList=[]}return models_createClass(OrderModel,[{key:"addOrder",value:function addOrder(e){this.itemList.push(e.id)}},{key:"removeOrder",value:function removeOrder(e){this.itemList=this.itemList.filter((function(t){return t!==e}))}},{key:"getOrder",value:function getOrder(){return{payment:this.payment,email:this.email,phone:this.phone,address:this.address,total:this.total,items:this.itemList}}},{key:"clear",value:function clear(){this.email="",this.address="",this.itemList=[],this.payment=null,this.phone="",this.total=0}}]),OrderModel}(),i=function(){function CatalogModel(){models_classCallCheck(this,CatalogModel),this.items=[]}return models_createClass(CatalogModel,[{key:"setItems",value:function setItems(e){this.items=e}},{key:"getItems",value:function getItems(){return this.items}},{key:"getItemByIdLocal",value:function getItemByIdLocal(e){return this.items.find((function(t){return t.id===e}))}}]),CatalogModel}(),a=function(){function BasketModel(){models_classCallCheck(this,BasketModel),this.items=[]}return models_createClass(BasketModel,[{key:"add",value:function add(e){this.items.push(e)}},{key:"remove",value:function remove(e){this.items=this.items.filter((function(t){return t.id!==e}))}},{key:"itemOnBasket",value:function itemOnBasket(e){return this.items.some((function(t){return t.id===e}))}},{key:"getCount",value:function getCount(){return this.items.length}},{key:"getTotal",value:function getTotal(){return this.items}},{key:"clear",value:function clear(){this.items=[]}}]),BasketModel}();function views_typeof(e){return views_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},views_typeof(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function _possibleConstructorReturn(e,t){if(t&&("object"===views_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}(this,r)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function views_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function views_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function views_toPrimitive(e,t){if("object"!==views_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==views_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===views_typeof(i)?i:String(i)),n)}var o,i}function views_createClass(e,t,r){return t&&views_defineProperties(e.prototype,t),r&&views_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var s=function(){function CatalogView(e){views_classCallCheck(this,CatalogView),this.mainPage=document.querySelector(".".concat(e))}return views_createClass(CatalogView,[{key:"render",value:function render(e){var t=this;this.mainPage.replaceChildren();var n=document.querySelector("#card-catalog");e.forEach((function(e){var o=n.content.querySelector(".card").cloneNode(!0);o.querySelector(".card__category").textContent=e.category,o.querySelector(".card__title").textContent=e.title,o.querySelector(".card__image").src=r+e.image;var i=o.querySelector(".card__price");null===e.price?i.textContent="Бесценно":i.textContent="".concat(e.price," синапсов"),o.addEventListener("click",(function(){var r;null===(r=t.onClick)||void 0===r||r.call(t,e.id)})),t.mainPage.append(o)}))}}]),CatalogView}(),c=views_createClass((function ModalView(){var e=this;views_classCallCheck(this,ModalView),this.modalWindow=document.querySelector(".modal"),this.cardPage=this.modalWindow.querySelector(".modal__content"),this.closeButton=this.modalWindow.querySelector(".modal__close"),this.popup=this.modalWindow,this.closeByOverlay=function(){e.closeModal()},this.addOverlayListener=function(){e.popup.addEventListener("click",e.closeByOverlay)},this.removeOverlayListener=function(){e.popup.removeEventListener("click",e.closeByOverlay)},this.closeByEscape=function(t){"Escape"===t.key&&e.closeModal()},this.openModal=function(){e.popup.classList.add("modal_active");var t=e.popup.querySelector(".modal__container");document.addEventListener("keydown",e.closeByEscape),e.popup.addEventListener("click",e.closeByOverlay),t.addEventListener("mouseleave",e.addOverlayListener),t.addEventListener("mouseenter",e.removeOverlayListener)},this.closeModal=function(){e.popup.classList.remove("modal_active");var t=e.popup.querySelector(".modal__container");e.popup.removeEventListener("click",e.closeByOverlay),t.removeEventListener("mouseleave",e.addOverlayListener),t.removeEventListener("mouseenter",e.removeOverlayListener),document.removeEventListener("keydown",e.closeByEscape)},this.closeButton.addEventListener("click",(function(){e.closeModal()}))})),l=function(e){_inherits(CardView,e);var t=_createSuper(CardView);function CardView(){var e;return views_classCallCheck(this,CardView),(e=t.call(this)).cardTemplate=document.querySelector("#card-preview"),e.cardElement=e.cardTemplate.content.querySelector(".card").cloneNode(!0),e.category=e.cardElement.querySelector(".card__category"),e.title=e.cardElement.querySelector(".card__title"),e.image=e.cardElement.querySelector(".card__image"),e.text=e.cardElement.querySelector(".card__text"),e.button=e.cardElement.querySelector(".card__button"),e.price=e.cardElement.querySelector(".card__price"),e.cardPage.addEventListener("click",(function(t){var r,n=t.target;if(n.closest(".card__button")){if(!n.closest(".card__row"))return;null===(r=e.onBuy)||void 0===r||r.call(_assertThisInitialized(e),e.id)}else;})),e}return views_createClass(CardView,[{key:"render",value:function render(e){this.cardPage.replaceChildren(),this.category.textContent=e.category,this.title.textContent=e.title,this.image.src=r+e.image,this.text.textContent=e.description,this.id=e.id,e.price&&(this.price.textContent="".concat(e.price," синапсов")),this.cardPage.append(this.cardElement),this.openModal()}},{key:"disableBuyButton",value:function disableBuyButton(){this.button.textContent="Товар уже в корзине",this.button.setAttribute("disabled",""),this.button.style.backgroundColor="grey"}},{key:"disableBuyButtonNull",value:function disableBuyButtonNull(){this.price.textContent="Бесценно",this.button.textContent="Невозможно",this.button.setAttribute("disabled",""),this.button.style.backgroundColor="grey"}},{key:"enableBuyButton",value:function enableBuyButton(){this.button.textContent="В корзину",this.button.removeAttribute("disabled"),this.button.style.backgroundColor="white"}}]),CardView}(c),u=function(e){_inherits(BasketItemView,e);var t=_createSuper(BasketItemView);function BasketItemView(){return views_classCallCheck(this,BasketItemView),t.call(this)}return views_createClass(BasketItemView,[{key:"renderInBasket",value:function renderInBasket(e,t){var r=document.querySelector("#card-basket").content.querySelector(".card_compact").cloneNode(!0),n=r.querySelector(".basket__item-index"),o=r.querySelector(".card__title"),i=r.querySelector(".card__price");return r.dataset.id=e.id,n.textContent="".concat(e.index),o.textContent=e.title,i.textContent="".concat(e.price),t.append(r),t}}]),BasketItemView}(c),d=function(e){_inherits(BasketView,e);var t=_createSuper(BasketView);function BasketView(){var e;return views_classCallCheck(this,BasketView),(e=t.call(this)).icon=document.querySelector(".header__basket"),e.counter=e.icon.querySelector(".header__basket-counter"),e.basketTemplate=document.querySelector("#basket"),e.basketElement=e.basketTemplate.content.querySelector(".basket").cloneNode(!0),e.basketList=e.basketElement.querySelector(".basket__list"),e.deleteButton=e.basketElement.querySelector(".button"),e.basketPrice=e.basketElement.querySelector(".basket__price"),e.placeOrderBtn=e.basketElement.querySelector(".basket__button"),e.icon.addEventListener("click",(function(){e.openBasket()})),e.cardPage.addEventListener("click",(function(t){var r,n,o=t.target,i=o.closest(".basket__item-delete");if(i){t.stopPropagation();var a=i.closest(".card_compact");if(!a)return;var s=a.dataset.id;if(!s)return;null===(r=e.onDeleteItem)||void 0===r||r.call(_assertThisInitialized(e),s)}else{o.closest(".basket__button")&&(null===(n=e.onPlaceOrder)||void 0===n||n.call(_assertThisInitialized(e)))}})),e}return views_createClass(BasketView,[{key:"renderCounter",value:function renderCounter(e){this.counter.textContent="".concat(e)}},{key:"render",value:function render(e,t){this.cardPage.replaceChildren(),this.basketList=e,this.basketPrice.textContent="".concat(t," синапсов"),0===t?this.placeOrderBtn.setAttribute("disabled","true"):this.placeOrderBtn.removeAttribute("disabled"),this.cardPage.append(this.basketElement),this.openModal()}},{key:"getBasketList",value:function getBasketList(){return this.basketList}}]),BasketView}(c),p=function(e){_inherits(OrderFirstView,e);var t=_createSuper(OrderFirstView);function OrderFirstView(){var e;return views_classCallCheck(this,OrderFirstView),(e=t.call(this)).orderFirstTemplate=document.querySelector("#order"),e.orderFirstElement=e.orderFirstTemplate.content.querySelector(".form").cloneNode(!0),e.formErrors=e.orderFirstElement.querySelector(".form__errors"),e.cardBtn=e.orderFirstElement.querySelector("[name=card]"),e.cashBtn=e.orderFirstElement.querySelector("[name=cash]"),e.inputAddress=e.orderFirstElement.querySelector("[name=address]"),e.nextBtn=e.orderFirstElement.querySelector(".order__button"),e.cardBtn.dataset.choice="false",e.cashBtn.dataset.choice="false",e.cardPage.addEventListener("click",(function(t){var r,n=t.target;return n.closest("[name=card]")?(e.toggleBtn(e.cardBtn,e.cashBtn),void e.checkValid()):n.closest("[name=cash")?(e.toggleBtn(e.cashBtn,e.cardBtn),void e.checkValid()):void(n.closest(".order__button")&&(null===(r=e.onNextPage)||void 0===r||r.call(_assertThisInitialized(e),t,e.orderFirstElement)))})),e.orderFirstElement.addEventListener("input",(function(){e.checkValid()})),e}return views_createClass(OrderFirstView,[{key:"checkValid",value:function checkValid(){"false"===this.cardBtn.dataset.choice&&"false"===this.cashBtn.dataset.choice?(this.formErrors.textContent="выберите способ оплаты",this.nextBtn.setAttribute("disabled","true")):0===this.inputAddress.value.length?(this.formErrors.textContent="укажите адрес доставки",this.nextBtn.setAttribute("disabled","true")):(this.formErrors.textContent="",this.nextBtn.removeAttribute("disabled"))}},{key:"toggleBtn",value:function toggleBtn(e,t){e.style.outline="2px solid white",e.dataset.choice="true",t.style.outline="none",t.dataset.choice="false"}},{key:"clearForm",value:function clearForm(){this.inputAddress.value="",this.cardBtn.dataset.choice="false",this.cardBtn.style.outline="none",this.cashBtn.dataset.choice="false",this.cashBtn.style.outline="none",this.formErrors.textContent=""}},{key:"render",value:function render(){this.cardPage.replaceChildren(),this.cardPage.append(this.orderFirstElement)}}]),OrderFirstView}(c),f=function(e){_inherits(OrderSecondView,e);var t=_createSuper(OrderSecondView);function OrderSecondView(){var e;return views_classCallCheck(this,OrderSecondView),(e=t.call(this)).orderSecondTemplate=document.querySelector("#contacts"),e.orderSecondElement=e.orderSecondTemplate.content.querySelector(".form").cloneNode(!0),e.formErrors=e.orderSecondElement.querySelector(".form__errors"),e.emailInput=e.orderSecondElement.querySelector("[name=email]"),e.phoneInput=e.orderSecondElement.querySelector("[name=phone]"),e.payBtn=e.orderSecondElement.querySelector(".button"),e.cardPage.addEventListener("input",(function(){e.checkValid()})),e.cardPage.addEventListener("click",(function(t){var r,n=t.target;if(n.closest(".button")){if(!n.closest("[name=contacts]"))return;null===(r=e.payOrder)||void 0===r||r.call(_assertThisInitialized(e),t,e.orderSecondElement)}})),e}return views_createClass(OrderSecondView,[{key:"checkValid",value:function checkValid(){0===this.emailInput.value.length?(this.formErrors.textContent="укажите майл",this.payBtn.setAttribute("disabled","true")):0===this.phoneInput.value.length?(this.formErrors.textContent="укажите телефон",this.payBtn.setAttribute("disabled","true")):(this.formErrors.textContent="",this.payBtn.removeAttribute("disabled"))}},{key:"clearForm",value:function clearForm(){this.emailInput.value="",this.phoneInput.value="",this.formErrors.textContent=""}},{key:"render",value:function render(){this.cardPage.replaceChildren(),this.cardPage.append(this.orderSecondElement)}}]),OrderSecondView}(c),m=function(e){_inherits(OrderSuccessView,e);var t=_createSuper(OrderSuccessView);function OrderSuccessView(){var e;return views_classCallCheck(this,OrderSuccessView),(e=t.call(this)).orderSuccessTemplate=document.querySelector("#success"),e.orderSuccessElement=e.orderSuccessTemplate.content.querySelector(".order-success").cloneNode(!0),e.orderDescription=e.orderSuccessElement.querySelector(".order-success__description"),e.cardPage.addEventListener("click",(function(t){t.target.closest(".order-success__close")&&e.closeModal()})),e}return views_createClass(OrderSuccessView,[{key:"render",value:function render(e){this.cardPage.replaceChildren(),this.orderDescription.textContent="Списано ".concat(e," синапсов"),this.cardPage.append(this.orderSuccessElement)}}]),OrderSuccessView}(c),y=new e(t),h=new i,v=new a,_=new o,b=new s("gallery"),g=new l,k=new u,w=new d,S=new p,C=new f,B=new m;b.onClick=function(e){y.get("/product/".concat(e)).then((function(e){var t={category:e.category,title:e.title,image:e.image,price:e.price,description:e.description,id:e.id};null===e.price?g.disableBuyButtonNull():v.itemOnBasket(e.id)?g.disableBuyButton():g.enableBuyButton(),g.render(t)}))},g.onBuy=function(e){var t=h.getItemByIdLocal(e);_.addOrder(t),v.add(t),w.renderCounter(v.getCount()),g.disableBuyButton()},w.onDeleteItem=function(e){v.remove(e),_.removeOrder(e),w.renderCounter(v.getCount()),g.enableBuyButton(),w.openBasket()},w.onPlaceOrder=function(){S.render()},S.onNextPage=function(e,t){e.preventDefault();var r=t.querySelector("[name=card]"),n=t.querySelector("[name=cash]"),o=t.querySelector("[name=address]");"true"===r.dataset.choice&&(_.payment="online"),"true"===n.dataset.choice&&(_.payment="on delivery"),_.address=o.value,C.render()},C.payOrder=function(e,t){e.preventDefault();var r=t.querySelector("[name=email]"),n=t.querySelector("[name=phone]");_.email=r.value,_.phone=n.value;var o=_.getOrder();y.post("/order",o).then((function(e){B.render(_.total),B.startNewOrder()})).catch((function(e){}))},B.startNewOrder=function(){_.clear(),v.clear(),w.renderCounter(0),S.clearForm(),C.clearForm()},w.openBasket=function(){for(var e=v.getTotal(),t=[],r=0,n=0;n<e.length;n++)t.push({id:e[n].id,index:n+1,title:e[n].title,price:e[n].price}),r+=e[n].price;var o=w.getBasketList();o.replaceChildren(),t.forEach((function(e){o=k.renderInBasket(e,o)})),_.total=r,w.render(o,r)},y.get("/product").then((function(e){var t=e.items.map((function(e){return new n(e)}));h.setItems(t);var r=h.getItems().map((function(e){return{id:e.id,category:e.category,title:e.title,image:e.image,price:e.price}}));b.render(r)}))})();
//# sourceMappingURL=main.js.map